{% extends "layout.html" %}
{% block content %}
<div class="container mt-4">
    <h2>{{ quiz.title }}</h2>
    <div id="quiz-container">
        <div id="question">
            <p id="question-text"></p>
            <form id="question-form">
                {% for option in questions[currentQuestionIndex].options %}
                <label>
                    <input type="radio" name="user_answer" value="{{ option.id }}">
                    {{ option.option1 }}
                </label><br>
                {% endfor %}
            </form>
            <button id="next-button">Next</button>
        </div>
    </div>
</div>

<script>
    const quizContainer = document.getElementById('quiz-container');
    const question = document.getElementById('question');
    const questionText = document.getElementById('question-text');
    const questionForm = document.getElementById('question-form');
    const nextButton = document.getElementById('next-button');
    let currentQuestionIndex = 0;
    let timer;

    // Array to store quiz questions
    const questions = {{ questions | tojson | safe }};

    function displayQuestion() {
        const currentQuestion = questions[currentQuestionIndex];
        questionText.textContent = `Q. ${currentQuestion.text}`;

        // Display options
        let optionsHTML = '';
        currentQuestion.options.forEach(option => {
            optionsHTML += `
                <label>
                    <input type="radio" name="user_answer" value="${option.id}">
                    ${option.option1}
                </label><br>`;
        });
        questionForm.innerHTML = optionsHTML;
    }

    function startTimer(seconds) {
        let timeLeft = seconds;
        clearInterval(timer);
        timer = setInterval(function () {
            if (timeLeft <= 0) {
                clearInterval(timer);
                // Automatically move to the next question when the timer expires
                nextQuestion();
            } else {
                timeLeft--;
            }
        }, 1000); // Update every second
    }

    function nextQuestion() {
        if (currentQuestionIndex < questions.length - 1) {
            currentQuestionIndex++;
            displayQuestion();
            startTimer(questions[currentQuestionIndex].timer);
        } else {
            // Quiz is complete
            alert('Quiz completed!');
            // You can redirect the user or perform other actions here
        }
    }

    nextButton.addEventListener('click', function () {
        clearInterval(timer); // Stop the timer when moving to the next question
        nextQuestion();
    });

    // Start the quiz with the first question
    displayQuestion();
    startTimer(questions[0].timer);
</script>
{% endblock %}
